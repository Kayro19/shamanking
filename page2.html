<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Survey</title>
<style>
  .survey-item {
    margin-bottom: 20px;
  }
  .btn {
    padding: 10px 20px;
    margin-right: 8px;
    border: 1px solid #444;
    background-color: #eee;
    cursor: pointer;
    user-select: none;
  }
  .btn.selected {
    background-color: #4CAF50;
    color: white;
    border-color: #4CAF50;
  }
  #submit-btn {
    padding: 10px 25px;
    font-size: 16px;
    cursor: pointer;
  }
</style>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

</head>
<body>

<h2>Survey</h2>

<div class="survey-item" data-item="1">
  <div>1. Choose one:</div>
  <button class="btn" data-letter="A">A</button>
  <button class="btn" data-letter="B">B</button>
  <button class="btn" data-letter="C">C</button>
  <button class="btn" data-letter="D">D</button>
</div>

<div class="survey-item" data-item="2">
  <div>2. Choose one:</div>
  <button class="btn" data-letter="A">A</button>
  <button class="btn" data-letter="B">B</button>
  <button class="btn" data-letter="C">C</button>
  <button class="btn" data-letter="D">D</button>
</div>

<div class="survey-item" data-item="3">
  <div>3. Choose one:</div>
  <button class="btn" data-letter="A">A</button>
  <button class="btn" data-letter="B">B</button>
  <button class="btn" data-letter="C">C</button>
  <button class="btn" data-letter="D">D</button>
</div>

<div class="survey-item" data-item="4">
  <div>4. Choose one:</div>
  <button class="btn" data-letter="A">A</button>
  <button class="btn" data-letter="B">B</button>
  <button class="btn" data-letter="C">C</button>
  <button class="btn" data-letter="D">D</button>
</div>

<div class="survey-item" data-item="5">
  <div>5. Choose one:</div>
  <button class="btn" data-letter="A">A</button>
  <button class="btn" data-letter="B">B</button>
  <button class="btn" data-letter="C">C</button>
  <button class="btn" data-letter="D">D</button>
</div>

<button id="submit-btn">Submit</button>

<script>
  // Initialize Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyD_5YgdpDfpa0dJtcfkUii_UjCKO9oF4J0",
    authDomain: "shamankingdata.firebaseapp.com",
    projectId: "shamankingdata",
    storageBucket: "shamankingdata.appspot.com",
    messagingSenderId: "757444066890",
    appId: "1:757444066890:web:e4f9d41e2905e588d930b3"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Button selection logic
  document.querySelectorAll('.survey-item').forEach(item => {
    const buttons = item.querySelectorAll('.btn');
    buttons.forEach(button => {
      button.addEventListener('click', () => {
        buttons.forEach(btn => btn.classList.remove('selected'));
        button.classList.add('selected');
      });
    });
  });

  // Submit button handler
  document.getElementById('submit-btn').addEventListener('click', async () => {
    const results = {};
    let allAnswered = true;

    document.querySelectorAll('.survey-item').forEach(item => {
      const selectedBtn = item.querySelector('.btn.selected');
      const itemNum = item.getAttribute('data-item');
      if (selectedBtn) {
        results[`item${itemNum}`] = selectedBtn.getAttribute('data-letter');
      } else {
        allAnswered = false;
      }
    });

    if (!allAnswered) {
      alert('Please answer all questions before submitting.');
      return;
    }

    try {
      await db.collection('responses').add({
        answers: results,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      alert('Thanks for submitting!');

      showAggregatedResults();

    } catch (error) {
      console.error('Error saving response:', error);
      alert('Failed to save your answers. Try again.');
    }
  });

  // Show aggregated results function
  async function showAggregatedResults() {
    const snapshot = await db.collection('responses').get();

    const counts = {};
    for (let i = 1; i <= 5; i++) {
      counts[`item${i}`] = { A: 0, B: 0, C: 0, D: 0 };
    }

    snapshot.forEach(doc => {
      const answers = doc.data().answers;
      for (const [item, letter] of Object.entries(answers)) {
        if (counts[item] && counts[item][letter] !== undefined) {
          counts[item][letter]++;
        }
      }
    });

    let resultText = 'Aggregated Results:\n\n';
    for (let i = 1; i <= 5; i++) {
      const itemCounts = counts[`item${i}`];
      resultText += `Item ${i}:\n`;
      for (const [letter, count] of Object.entries(itemCounts)) {
        resultText += `  ${letter}: ${count}\n`;
      }
    }

    alert(resultText);
  }
</script>

</body>
</html>

 
  
